---
layout: page
subheadline:  "fix PC boot problem"
title:  "Fix whatever boot failure (dual boot)"
teaser: "fix grub or dual boot for linux and windows"
categories:
    - grub
tags:
    - boot
    - grub
    - dual boot
    - chroot
comments: true
show_meta: true

---
<div class="row">
<div class="medium-7 medium-push-10 columns" markdown="1">
<div class="panel radius" markdown="1">
**Table of Contents**
{: #toc }
*  TOC
{:toc}
</div>
</div><!-- /.medium-4.columns -->



<div class="medium-14 medium-pull-3 columns" markdown="1">



<h1> Probelms </h1>
<br> 
<br> 
I first install Ubuntu on the secondary SSD(sdb) with /boot on the first SSD(sda)
Then I manually format /sda and wipe out everything
Next I installed a Windows 10 and it worked fine. But I can't get into Ubuntu. Even with grub rescue, for some reason I can't explain (it could boot but get stuck in the middle).

When running in LiveCD
	sudo grub-install
I got this error
	/usr/sbin/grub-probe:error:failed to get canonical path of /cow.

<h1> Solution </h1>

So here is the trick to purge the old grub in Ubuntu from LiveCD(flash drive) by chroot.


Note: If you could get into your Ubuntu, don't bother use LiveCD, just jump to the purge step, step 4.

Note: reinstall grub require Internet, you need to get LiveCD connected to Internet before proceed. If you don't have access to Internet, [this](http://ubuntuforums.org/showthread.php?t=1581099) give solution to install grub without Internet, I haven't try it though.

Note: chroot stands for change root. It pretend the path you changing to to be the toot /. So if you change root to another Ubuntu system, it allows you to get access to that Ubuntu and act as if you are running on it. 

<br> 

Main Idea
===
* 1. boot into LiveCD and select Try Ubuntu without install
* 2. setup the envirnment for chroot
* 3. run chroot command on local Ubuntu(the one on the hard drive that you can't boot into).
* 4. purge and reinstall gurb
* 5. reboot and select grub as bootable in BIOS.
* 6. successfully go into grub and life is good again.


<br> 
<h3> 1. boot into LiveCD and select Try Ubuntu without install </h3>
Create a bootable usb of ubuntu.

<br> 
<h3> 2. setup the envirnment for chroot</h3>
to see what hard drive you have 
	ls /dev/sd*

hard dirve are in the form of sdXY, X are a, b, c..., stands for different hard drive and Y are 1, 2, 3... stands for the partitions on the hard drive.


* mount you partition where your local Ubuntu is
	sudo mount /dev/sdb1 /mnt/chrootdir # change sdb1 accordingly, where your Ubuntu root / is
* (optional) mount boot partition
 only if you have a seprate boot partition [Reference](http://ubuntuforums.org/showthread.php?t=1581099)
	sudo mount /dev/sda1 /mnt/chrootdir/boot # change sda1 accordingly, where your boot partition is
* get the Internet setting to solve the domain names
	cp -L /etc/resolv.conf /mnt/etc/resolv.conf

* Bind necessary directory 
	for i in /dev /dev/pts /proc /sys; do sudo mount -B $i /mnt/temp$i;  done

* 
<br> 
<h3> 3. run chroot command on local Ubuntu</h3>
* change root to /mnt/chrootdir
	chroot /mnt/chrootdir

	(If this returns an error chroot: cannot run command '/bin/bash': Exec format error, this usually indicates that you booted with one architecture (e.g. x86_32) and are trying to chroot into another (e.g. x86_64). The solution is to use a LiveCD which has the same architecture as the system you want to chroot into.)

* confirm Internet connection
	apt-get update
	if your Internet didn't connected DO NOT proceed, 
	exit and use the method without Internet

<br> 
<h3> 4. purge and reinstall gurb</h3>
* purge everything about grub
	apt-get purge grub grub-pc grub-common
* reinstall grub
	apt-get install grub-common grub-pc

You will be given the opportunity to add extra kernel options to the kernel line. If you don't know, you probably don't need them ; TAB to highlight "<OK>" and press ENTER.
Read the installation notes. TAB to "<OK>" to continue.
When presented with the device option, use the UP/DN keys to select the correct drive (sdX). 
Make sure the installation drive [*] /dev/sdX has an asterisk next to it ( example: [*] /dev/sda ). If it doesn't, highlight it and press the SPACE bar to select it.
Do not select a partition ( example: [ ] /dev/sda5 , etc).
TAB to "<OK>" and press ENTER. When it has finishing the installation, you should have Grub 2 installed.
[1]
<br> 
<h3> 5. reboot and select grub as bootable in BIOS.</h3>

<br> 
<h3> 6. successfully go into grub and life is good again.</h3>



<pre>
<code>


</code>
</pre>
Reference 
[1 HOWTO: Purge and Reinstall Grub 2 from the Live CD](http://ubuntuforums.org/showthread.php?t=1581099)
[2 What's the proper way to prepare chroot to recover a broken Linux installation?](http://superuser.com/questions/111152/whats-the-proper-way-to-prepare-chroot-to-recover-a-broken-linux-installation)
[3 Failed to get canonical path of /cow](http://askubuntu.com/questions/254491/failed-to-get-canonical-path-of-cow)
</div><!-- /.medium-8.columns -->

</div><!-- /.row -->
